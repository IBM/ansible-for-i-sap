<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Role upgrade_sap_kernel &mdash; IBM ansible-for-i-sap collection 1.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Role upgrade_sap_hana_client" href="upgrade_sap_hana_client.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> IBM ansible-for-i-sap collection
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation and configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install_and_config.html">Installation and configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Available roles</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install_saphostagent.html">Role install_saphostagent</a></li>
<li class="toctree-l1"><a class="reference internal" href="sap_install_app_server.html">Role sap_install_app_server</a></li>
<li class="toctree-l1"><a class="reference internal" href="sap_opsyscheck.html">Role sap_opsyscheck</a></li>
<li class="toctree-l1"><a class="reference internal" href="start_sap.html">Role start_sap</a></li>
<li class="toctree-l1"><a class="reference internal" href="stop_sap.html">Role stop_sap</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade_sap_hana_client.html">Role upgrade_sap_hana_client</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Role upgrade_sap_kernel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tags">Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variables">Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#remarks">Remarks:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#defaults">Defaults</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-playbook">Example Playbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="#author-information">Author Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">IBM ansible-for-i-sap collection</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Role upgrade_sap_kernel</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/IBM/ansible-for-i-sap/blob/main/docs/docsite/upgrade_sap_kernel.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="role-upgrade-sap-kernel">
<span id="ibm-ansible-for-i-sap-docsite-upgrade-sap-kernel"></span><h1><a class="toc-backref" href="#id9">Role upgrade_sap_kernel</a><a class="headerlink" href="#role-upgrade-sap-kernel" title="Permalink to this headline"></a></h1>
<p>The role upgrade_sap_kernel is used to upgrade the kernel of an already installed SAP system with new code that has been downloaded from the SAP Software Distribution Center (<a class="reference external" href="https://support.sap.com/swdc">SWDC</a>) in SAP Archive (SAR) files. The SAR files must be available in the download directory that is specified in variable <code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_download_managednode</span></code>. In a distributed landscape, it is recommended to share the download directory across all servers or logical partitions of that landscape. The role uses the tool APYSIDKRN, which is documented in <a class="reference external" href="https://launchpad.support.sap.com/#/notes/1632755">SAP Note 1632755</a>. It will apply the contents of <em>all</em> SAR files that are provided in the download directory. It is your responsibility to ensure that the downloaded SAR files are compatible with your SAP system and database.</p>
<p>You can either replace one or a few components of an SAP kernel, for example applying a new dw patch, or you can replace the complete kernel, for example with a new stack kernel or even a new release. If you are replacing the currently installed kernel with code of the same release and build level, variable <code class="docutils literal notranslate"><span class="pre">upgsapkrn_input_upgrade_mode</span></code> defines how to proceed: A value of <code class="docutils literal notranslate"><span class="pre">&quot;ADD&quot;</span></code> specifies that only the provided components are being replaces, a value of <code class="docutils literal notranslate"><span class="pre">&quot;FULLY&quot;</span></code> specifies, that the existing kernel is deleted and completely replaced with the contents of the downloaded SAR files.</p>
<p>If instance-specific directories are used for executables (see <a class="reference external" href="https://launchpad.support.sap.com/#/notes/1632754">SAP Note 1632754</a>), the new kernel will only be activated when stopping and starting the instances.</p>
<p>The role upgrade_sap_kernel needs the SAP System ID as input in variable <code class="docutils literal notranslate"><span class="pre">upgsapkrn_input_sap_sid</span></code>.</p>
<p>By specifying a tag, you define if you are replacing the currently installed kernel with code of the same release and build level (<code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">sap_kernel_upgrade_same_release</span></code>) or with code at a different release or build level (<code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">sap_kernel_upgrade_new_release</span></code>). SAP is marking different build levels in the same release with additions like “EXT” or “EX2”. The default is <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">sap_kernel_upgrade_same_release</span></code>.</p>
<p>Log files from the tool APYSIDKRN will be stored in directory /sapmnt/&lt;sid&gt;/patches/log. If you execute the role upgrade_sap_kernel frequently, you may want to cleanup this directory from time to time to save space on disk.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#role-upgrade-sap-kernel" id="id9">Role upgrade_sap_kernel</a></p>
<ul>
<li><p><a class="reference internal" href="#requirements" id="id10">Requirements</a></p></li>
<li><p><a class="reference internal" href="#tags" id="id11">Tags</a></p></li>
<li><p><a class="reference internal" href="#variables" id="id12">Variables</a></p></li>
<li><p><a class="reference internal" href="#defaults" id="id13">Defaults</a></p></li>
<li><p><a class="reference internal" href="#dependencies" id="id14">Dependencies</a></p></li>
<li><p><a class="reference internal" href="#example-playbook" id="id15">Example Playbook</a></p></li>
<li><p><a class="reference internal" href="#license" id="id16">License</a></p></li>
<li><p><a class="reference internal" href="#author-information" id="id17">Author Information</a></p></li>
<li><p><a class="reference internal" href="#copyright" id="id18">Copyright</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="requirements">
<h2><a class="toc-backref" href="#id10">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this headline"></a></h2>
<p>This role is intended for the operating system IBM i. The target system must be enabled to execute Ansible playbooks. For details, see the prerequisites section in <a class="reference internal" href="install_and_config.html#ibm-ansible-for-i-sap-docsite-install-and-config-prerequisites"><span class="std std-ref">Ansible Content for IBM Power Systems - IBM i with SAP Software</span></a>.</p>
<p>The SAP system must be configured to use the “New User Concept” as described in <a class="reference external" href="https://launchpad.support.sap.com/#/notes/1123501">SAP Note 1123501</a>.</p>
<p>The role upgrade_sap_kernel will install the contents of all SAR files in the download directory specified in variable <code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_download_managednode</span></code>. It is the responsibility of the user to ensure that the download directory contains all necessary patches for the required upgrade mode (<code class="docutils literal notranslate"><span class="pre">&quot;ADD&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;FULLY&quot;</span></code>).</p>
</section>
<section id="tags">
<h2><a class="toc-backref" href="#id11">Tags</a><a class="headerlink" href="#tags" title="Permalink to this headline"></a></h2>
<p>Specify one of the following tags to specify if the code in the downloaded SAR file is at the same release and build level as the currently installed kernel. If you do not specify a tag, <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">sap_kernel_upgrade_same_release</span></code> will be assumed as default. If you misspell the tag, an error message will be sent.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Tag</p></th>
<th class="head"><p>Usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sap_kernel_upgrade_same_release</span></code></p></td>
<td><p>The SAR file contains executables at the same release and build level
as the currently installed level. This is the default.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sap_kernel_upgrade_new_release</span></code></p></td>
<td><p>The SAR file contains executables at a different release or build level
than the currently installed level.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="variables">
<h2><a class="toc-backref" href="#id12">Variables</a><a class="headerlink" href="#variables" title="Permalink to this headline"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 60%" />
<col style="width: 6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Usage</p></th>
<th class="head"><p>Required</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_input_sap_sid</span></code></p></td>
<td><p>SAP system ID</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_temp_script_managednode</span></code></p></td>
<td><p>Directory for temporarily storing a script that is needed to execute the APYSIDKRN command</p></td>
<td><p>Yes <a class="footnote-reference brackets" href="#id7" id="id1">1</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_download_managednode</span></code></p></td>
<td><p>Download directory that contains the SAR files with the new kernel components to be installed.
To avoid runtime errors, the length of the path name should not exceed 220 characters.</p></td>
<td><p>Yes <a class="footnote-reference brackets" href="#id7" id="id2">1</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_temp_iletools_extract_managednode</span></code></p></td>
<td><p>Directory for temporarily extracting the ILETOOLS archive.</p></td>
<td><p>Yes <a class="footnote-reference brackets" href="#id7" id="id3">1</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_input_upgrade_mode</span></code></p></td>
<td><p>Upgrade mode: “ADD” or “FULLY”. This value is ignored when the tag
<code class="docutils literal notranslate"><span class="pre">sap_kernel_upgrade_new_release</span></code> is specified.</p></td>
<td><p>Yes <a class="footnote-reference brackets" href="#id8" id="id4">2</a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_sapcar_managednode</span></code></p></td>
<td><p>Path name to the SAPCAR tool</p></td>
<td><p>Yes <a class="footnote-reference brackets" href="#id7" id="id5">1</a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_file_sapcar</span></code></p></td>
<td><p>File name of the SAPCAR tool</p></td>
<td><p>Yes <a class="footnote-reference brackets" href="#id7" id="id6">1</a></p></td>
</tr>
</tbody>
</table>
<section id="remarks">
<h3>Remarks:<a class="headerlink" href="#remarks" title="Permalink to this headline"></a></h3>
<dl class="footnote brackets">
<dt class="label" id="id7"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>,<a href="#id3">3</a>,<a href="#id5">4</a>,<a href="#id6">5</a>)</span></dt>
<dd><p>Default provided.</p>
</dd>
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id4">2</a></span></dt>
<dd><p>Only required when tag <code class="docutils literal notranslate"><span class="pre">sap_kernel_upgrade_same_release</span></code> is selected. Default provided.</p>
</dd>
</dl>
</section>
</section>
<section id="defaults">
<h2><a class="toc-backref" href="#id13">Defaults</a><a class="headerlink" href="#defaults" title="Permalink to this headline"></a></h2>
<p>Suggested default values are provided in defaults/main.yml:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 65%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_temp_script_managednode</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;/tmp/kernel&quot;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_download_managednode</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;/tmp/downloads/kernel&quot;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_temp_iletools_extract_managednode</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;/tmp/apysidkrn&quot;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_input_upgrade_mode</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;ADD&quot;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_dir_sapcar_default_managednode</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;/usr/sap/hostctrl/exe&quot;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">upgsapkrn_file_sapcar</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;SAPCAR&quot;</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="dependencies">
<h2><a class="toc-backref" href="#id14">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this headline"></a></h2>
<p>None.</p>
</section>
<section id="example-playbook">
<h2><a class="toc-backref" href="#id15">Example Playbook</a><a class="headerlink" href="#example-playbook" title="Permalink to this headline"></a></h2>
<p>The example playbook is used to replace the existing kernel of SAP system PRD with a new stack kernel in the same release on several hosts. It is based on the assumption that a configuration file and an inventory file with contents similar to the <a class="reference internal" href="install_and_config.html#ibm-ansible-for-i-sap-docsite-install-and-config-configuration"><span class="std std-ref">configuration documentation</span></a> exist in the current directory. The necessary archives must have been downloaded from the SAP Software Distribution Center and stored in directory /tmp/downloads/kernel. The playbook is located in the current directory, named replace_kernel_in_same_release.yml and has the following contents:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ibmi_servers</span><span class="w"></span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">upgsapkrn_input_sap_sid</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PRD&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">upgsapkrn_input_upgrade_mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;FULLY&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;ansible_dir&gt;/roles/upgrade_sap_kernel</span><span class="w"></span>
</pre></div>
</div>
<p>To execute this playbook, enter the command:</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-playbook --verbose replace_kernel_in_same_release.yml -t sap_kernel_upgrade_same_release</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="license">
<h2><a class="toc-backref" href="#id16">License</a><a class="headerlink" href="#license" title="Permalink to this headline"></a></h2>
<p>This collection is licensed under the <a class="reference external" href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>.</p>
</section>
<section id="author-information">
<h2><a class="toc-backref" href="#id17">Author Information</a><a class="headerlink" href="#author-information" title="Permalink to this headline"></a></h2>
<p>SAP on IBM Power Development Team</p>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#id18">Copyright</a><a class="headerlink" href="#copyright" title="Permalink to this headline"></a></h2>
<p>Copyright IBM Corporation 2021,2022</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="upgrade_sap_hana_client.html" class="btn btn-neutral float-left" title="Role upgrade_sap_hana_client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021,2022, IBM.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>